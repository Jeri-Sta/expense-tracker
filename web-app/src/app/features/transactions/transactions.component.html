<div class="transactions-container">
  <!-- Header with Actions -->
  <div class="card">
    <div class="flex flex-column md:flex-row md:justify-content-between md:align-items-center mb-4">
      <div class="mb-2 md:mb-0">
        <h2 class="text-2xl font-bold text-color m-0">
          Transações
        </h2>
        <p class="text-color-secondary m-0">Gerencie suas receitas e despesas de forma eficiente</p>
      </div>
      <div class="flex gap-2">
        <p-button 
          label="Nova Transação" 
          icon="pi pi-plus" 
          size="small"
          (click)="openTransactionDialog()"
          styleClass="p-button-primary"
        ></p-button>
      </div>
    </div>
  </div>

  <!-- Transactions Table -->
  <div class="card">
    <p-table 
      [value]="transactions" 
      [loading]="loading"
      [paginator]="true" 
      [rows]="rows"
      [first]="first"
      [totalRecords]="totalRecords"
      [lazy]="true"
      (onLazyLoad)="onLazyLoad($event)"
      styleClass="p-datatable-striped"
      responsiveLayout="scroll"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Data</th>
          <th>Descrição</th>
          <th>Categoria</th>
          <th>Tipo</th>
          <th>Valor</th>
          <th style="width: 120px">Ações</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-transaction>
        <tr>
          <td>{{ transaction.transactionDate | date:'dd/MM/yyyy' }}</td>
          <td>
            <div class="flex flex-column">
              <span class="font-semibold">{{ transaction.description }}</span>
              <span class="text-sm text-600" *ngIf="transaction.notes">{{ transaction.notes }}</span>
            </div>
          </td>
          <td>
            <div class="flex align-items-center gap-2" *ngIf="transaction.category">
              <i [class]="transaction.category.icon" [style.color]="transaction.category.color"></i>
              <span>{{ transaction.category.name }}</span>
            </div>
          </td>
          <td>
            <p-tag 
              [value]="transaction.type === 'income' ? 'Receita' : 'Despesa'"
              [severity]="transaction.type === 'income' ? 'success' : 'danger'"
            ></p-tag>
          </td>
          <td>
            <span 
              [class]="transaction.type === 'income' ? 'text-green-600' : 'text-red-600'"
              class="font-semibold"
            >
              {{ transaction.amount | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
            </span>
          </td>
          <td>
            <div class="flex gap-1">
              <p-button 
                icon="pi pi-pencil" 
                (click)="editTransaction(transaction)"
                styleClass="p-button-text p-button-sm"
                pTooltip="Editar"
              ></p-button>
              <p-button 
                icon="pi pi-trash" 
                (click)="deleteTransaction(transaction)"
                styleClass="p-button-text p-button-danger p-button-sm"
                pTooltip="Excluir"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center py-4">
            <div class="flex flex-column align-items-center gap-3">
              <i class="pi pi-inbox text-4xl text-400"></i>
              <span class="text-lg">Nenhuma transação encontrada</span>
              <p-button 
                label="Adicionar Primeira Transação" 
                icon="pi pi-plus" 
                (click)="openTransactionDialog()"
                styleClass="p-button-primary"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Transaction Dialog -->
  <p-dialog 
    header="{{ editingTransaction ? 'Editar Transação' : 'Nova Transação' }}"
    [(visible)]="showTransactionDialog"
    [modal]="true"
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    styleClass="p-dialog-maximized md:p-dialog-default"
    [style]="{width: '500px'}"
  >
    <form [formGroup]="transactionForm" (ngSubmit)="saveTransaction()">
      <!-- Type Selection -->
      <div class="field mb-4">
        <label class="block text-sm font-medium mb-2">
          Tipo <span class="required-asterisk">*</span>
        </label>
        <p-dropdown 
          formControlName="type"
          [options]="getTypeOptions()"
          optionLabel="label"
          optionValue="value"
          placeholder="Selecione o tipo"
          styleClass="w-full"
        ></p-dropdown>
      </div>

      <!-- Amount -->
      <div class="field mb-4">
        <label for="amount" class="block text-sm font-medium mb-2">
          Valor <span class="required-asterisk">*</span>
        </label>
        <p-inputNumber
          id="amount"
          formControlName="amount"
          mode="currency"
          currency="BRL"
          locale="pt-BR"
          placeholder="0,00"
          styleClass="w-full"
        ></p-inputNumber>
        <small 
          class="text-red-500" 
          *ngIf="submitted && transactionForm.get('amount')?.invalid"
        >
          Valor é obrigatório
        </small>
      </div>

      <!-- Description -->
      <div class="field mb-4">
        <label for="description" class="block text-sm font-medium mb-2">
          Descrição <span class="required-asterisk">*</span>
        </label>
        <input 
          id="description"
          type="text" 
          pInputText 
          formControlName="description"
          placeholder="Descrição da transação"
          class="w-full"
        />
        <small 
          class="text-red-500" 
          *ngIf="submitted && transactionForm.get('description')?.invalid"
        >
          Descrição é obrigatória
        </small>
      </div>

      <!-- Category -->
      <div class="field mb-4">
        <label for="categoryId" class="block text-sm font-medium mb-2">
          Categoria <span class="required-asterisk">*</span>
        </label>
        <p-dropdown
          id="categoryId"
          formControlName="categoryId"
          [options]="getCategoryDropdownOptions()"
          placeholder="Selecione a categoria"
          styleClass="w-full"
        >
          <ng-template let-category pTemplate="selectedItem">
            <div class="flex align-items-center gap-2" *ngIf="category">
              <i [class]="category.icon" [style.color]="category.color"></i>
              <span>{{ category.label }}</span>
            </div>
          </ng-template>
          <ng-template let-category pTemplate="item">
            <div class="flex align-items-center gap-2">
              <i [class]="category.icon" [style.color]="category.color"></i>
              <span>{{ category.label }}</span>
            </div>
          </ng-template>
        </p-dropdown>
        <small 
          class="text-red-500" 
          *ngIf="submitted && transactionForm.get('categoryId')?.invalid"
        >
          Categoria é obrigatória
        </small>
      </div>

      <!-- Date -->
      <div class="field mb-4">
        <label for="transactionDate" class="block text-sm font-medium mb-2">
          Data <span class="required-asterisk">*</span>
        </label>
        <p-calendar
          id="transactionDate"
          formControlName="transactionDate"
          placeholder="dd/mm/aaaa"
          dateFormat="dd/mm/yy"
          styleClass="w-full"
        ></p-calendar>
        <small 
          class="text-red-500" 
          *ngIf="submitted && transactionForm.get('transactionDate')?.invalid"
        >
          Data é obrigatória
        </small>
      </div>

      <!-- Notes -->
      <div class="field mb-4">
        <label for="notes" class="block text-sm font-medium mb-2">
          Observações
        </label>
        <textarea 
          id="notes"
          pInputTextarea 
          formControlName="notes"
          placeholder="Observações adicionais (opcional)"
          rows="3"
          class="w-full"
        ></textarea>
      </div>

      <div class="flex justify-content-end gap-2 mt-4">
        <p-button 
          label="Cancelar" 
          icon="pi pi-times" 
          (click)="closeTransactionDialog()"
          styleClass="p-button-text"
          type="button"
        ></p-button>
        <p-button 
          [label]="editingTransaction ? 'Atualizar' : 'Salvar'" 
          icon="pi pi-check" 
          type="submit"
          [loading]="loading"
        ></p-button>
      </div>
    </form>
  </p-dialog>
</div>